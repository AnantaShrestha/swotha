/*! Nestoria Slider - v1.0.13 - 2015-07-16
* http://lokku.github.io/jquery-nstslider/
* Copyright (c) 2015 Lokku Ltd.; Licensed MIT */
(function(f){var h;var m;var j;var i;var k;var c;var l;var d;var g;var b={setNakedBarDelta:function(n,o){if(n==="stickToSides"){g={toEndWidth:o,toBeginLeft:0,toBeginWidth:o}}else{if(n==="middle"){g={toEndWidth:o/2,toBeginLeft:o/2,toBeginWidth:o/2}}else{throw new Error("unknown position of setNakedBarDelta: "+n)}}},getSliderValuesAtPositionPx:function(n,q){var t=this,r,p,s=t.data("pixel_to_value_mapping");if(typeof s!=="undefined"){r=s(n);p=s(q)}else{var o=b.getSliderWidthPx.call(t)-t.data("left_grip_width");r=b.inverse_rangemap_0_to_n.call(t,n,o);p=b.inverse_rangemap_0_to_n.call(t,q,o)}return[r,p]},validateAndMoveGripsToPx:function(q,o){var r=this;var s=b.getSliderWidthPx.call(r)-r.data("left_grip_width");if(o<=s&&q>=0&&q<=s&&(!r.data("has_right_grip")||q<=o)){var p=r.data("cur_min"),n=r.data("cur_max");b.set_position_from_px.call(r,q,o);b.refresh_grips_style.call(r);b.notify_changed_implicit.call(r,"drag_move",p,n)}return r},updateAriaAttributes:function(){var q=this,p=q.data("settings"),n=q.find(p.left_grip_selector);if(q.data("has_right_grip")){var o=q.find(p.right_grip_selector);n.attr("aria-valuemin",q.data("range_min")).attr("aria-valuenow",e.get_current_min_value.call(q)).attr("aria-valuemax",e.get_current_max_value.call(q));o.attr("aria-valuemin",e.get_current_min_value.call(q)).attr("aria-valuenow",e.get_current_max_value.call(q)).attr("aria-valuemax",q.data("range_max"))}else{n.attr("aria-valuemin",q.data("range_min")).attr("aria-valuenow",e.get_current_min_value.call(q)).attr("aria-valuemax",q.data("range_max"))}return q},getSliderWidthPx:function(){var n=this;return Math.round(n.width())},getGripPositionPx:function(n){return parseInt(n.css("left").replace("px",""),10)},getLeftGripPositionPx:function(){var p=this,o=p.data("settings"),n=p.find(o.left_grip_selector);return b.getGripPositionPx.call(p,n)},getRightGripPositionPx:function(){var p=this,o=p.data("settings");if(p.data("has_right_grip")){return b.getGripPositionPx.call(p,p.find(o.right_grip_selector))}var n=b.getSliderWidthPx.call(p)-p.data("left_grip_width");return b.rangemap_0_to_n.call(p,p.data("cur_max"),n)},getLeftGripWidth:function(){var p=this,o=p.data("settings"),n=p.find(o.left_grip_selector);return Math.round(n.outerWidth())},getRightGripWidth:function(){var p=this,o=p.data("settings"),n=p.find(o.right_grip_selector);return Math.round(n.outerWidth())},binarySearchValueToPxCompareFunc:function(p,n,o){if(p===n[o]){return 0}if(p<n[o]&&o===0){return 0}if(n[o-1]<=p&&p<n[o]){return 0}if(p>n[o]){return 1}if(p<=n[o-1]){return -1}f.error("cannot compare s: "+p+" with a["+o+"]. a is: "+n.join(","))},binarySearch:function(t,v,p,o){var r=0;var q=t.length-1;var u;var s;while(r<=q){u=(r+q)/2|0;s=p(t,u);var n=o(v,t,u);if(n>0){r=u+1}else{if(n<0){q=u-1}else{return u}}}return -1},haveLimits:function(){var q=this,o=q.data("lower-limit"),n=q.data("upper-limit"),p=false;if(typeof o!=="undefined"&&typeof n!=="undefined"){p=true}return p},refresh_grips_style:function(){var t=this,r=t.data("settings");if(typeof r.highlight==="undefined"){return}var q=t.data("highlightedRangeMin");if(typeof q==="undefined"){return}var n=t.find(r.left_grip_selector),u=t.find(r.right_grip_selector),s=t.data("highlightedRangeMax"),v=t.data("cur_min"),p=t.data("cur_max"),o=r.highlight.grip_class;if(v<q||v>s){n.removeClass(o)}else{n.addClass(o)}if(p<q||p>s){u.removeClass(o)}else{u.addClass(o)}},set_position_from_val:function(r,q){var s=this;var p=s.data("range_min"),t=s.data("range_max");if(r<p){r=p}if(r>t){r=t}if(s.data("has_right_grip")){if(q>t){q=t}if(q<p){q=p}}else{q=s.data("cur_max")}var n=e.value_to_px.call(s,r),o=e.value_to_px.call(s,q);b.set_handles_at_px.call(s,n,o);s.data("cur_min",r);if(s.data("has_right_grip")){s.data("cur_max",q)}return s},set_position_from_px:function(n,p){var s=this;b.set_handles_at_px.call(s,n,p);var q=b.getSliderValuesAtPositionPx.call(s,n,p),r=q[0],o=q[1];s.data("cur_min",r);if(s.data("has_right_grip")){s.data("cur_max",o)}return s},set_handles_at_px:function(o,q){var u=this;var r=u.data("settings");var t=r.left_grip_selector,n=r.right_grip_selector,s=r.value_bar_selector;var p=u.data("left_grip_width");u.find(t).css("left",o+"px");u.find(n).css("left",q+"px");if(u.data("has_right_grip")){u.find(s).css("left",o+"px").css("width",(q-o+p)+"px")}else{if(!g){b.populateNakedBarDeltas.call(u,o,q,p)}if(q>o){u.find(s).css("left",o+"px").css("width",q-o+g.toEndWidth+"px")}else{u.find(s).css("left",q+g.toBeginLeft+"px").css("width",(o-q+g.toBeginWidth)+"px")}}return u},drag_start_func_touch:function(x,s,w,y,r){var z=this,v=x.originalEvent,u=v.touches[0];var o=u.pageY,p=u.pageX;var A=Math.abs(z.offset().top-o),t=z.offset().left,q=t-p,n=p-(t+z.width());if(A>s.touch_tolerance_value_bar_y||q>s.touch_tolerance_value_bar_x||n>s.touch_tolerance_value_bar_x){return}v.preventDefault();j=u.pageX;b.drag_start_func.call(z,u,s,w,y,r)},drag_start_func:function(A,B,q,p,C){var s=this;s.find(B.left_grip_selector+","+B.value_bar_selector+","+B.right_grip_selector).removeClass(B.animating_css_class);if(!e.is_enabled.call(s)){return}var o=f(A.target);var w=false;if(typeof B.highlight==="object"){w=o.is(B.highlight.panel_selector)}if(C===false&&!o.is(B.left_grip_selector)&&!o.is(B.right_grip_selector)&&!o.is(B.value_bar_selector)&&!w&&!o.is(s)){return}h=s;var E=b.getGripPositionPx.call(s,q),G=b.getSliderWidthPx.call(s)-s.data("left_grip_width"),z=q.offset().left,u,t,r,F,n,D;var y=b.getRightGripPositionPx.call(s);t=Math.round(A.pageX)-(s.data("left_grip_width")/2);r=Math.abs(z-t);n=t-z;if(s.data("has_right_grip")){u=p.offset().left;F=Math.abs(u-t);D=t-u}else{F=r*2;D=n*2}B.user_drag_start_callback.call(s,A);if(r===F){if(t<z){E+=n;i=true}else{y+=D;i=false}}else{if(r<F){E+=n;i=true}else{y+=D;i=false}}if(s.data("has_right_grip")){if(y>G){y=G}}else{if(E>G){E=G}}if(E<0){E=0}m=true;var v=s.data("cur_min"),x=s.data("cur_max");b.set_position_from_px.call(s,E,y);b.refresh_grips_style.call(s);b.notify_changed_implicit.call(s,"drag_start",v,x);if(Object.prototype.toString.apply(A)!=="[object Touch]"){A.preventDefault()}},drag_move_func_touch:function(n){if(m===true){var o=n.originalEvent;o.preventDefault();var p=o.touches[0];b.drag_move_func(p)}},drag_move_func:function(w){if(m){var y=h,p=y.data("settings"),q=b.getSliderWidthPx.call(y)-y.data("left_grip_width"),r=b.getLeftGripPositionPx.call(y);var t=b.getRightGripPositionPx.call(y);var s=Math.round(w.pageX);var A=s-j;var o=y.data("left_grip_width")/2,n=y.offset().left+y.data("left_grip_width")-o,x=n+q;if(p.crossable_handles===false&&y.data("has_right_grip")){if(i){x=n+t}else{n=n+r}}var B=0,v=0;if(s<n){B=1;v=0}if(s>x){v=1;B=0}if(p.crossable_handles===true&&y.data("has_right_grip")){if(i){if(t<=q){if(r+A>t){i=false;r=t}}}else{if(r>=0){if(t+A<r){i=true;t=r}}}}var u=r,z=t;if((A>0&&!B)||(A<0&&!v)){if(i){u+=A}else{z+=A}}b.validateAndMoveGripsToPx.call(y,u,z);j=s;if(Object.prototype.toString.apply(w)!=="[object Touch]"){w.preventDefault()}}},drag_end_func_touch:function(n){var o=n.originalEvent;o.preventDefault();var p=o.touches[0];b.drag_end_func(p)},drag_end_func:function(){var o=h;if(typeof o!=="undefined"){m=false;j=undefined;b.notify_mouse_up_implicit.call(o,i);h=undefined;var n=o.data("settings");o.find(n.left_grip_selector+","+n.value_bar_selector+","+n.right_grip_selector).addClass(n.animating_css_class)}},get_rounding_for_value:function(p){var s=this;var o=s.data("rounding");var n=s.data("rounding_ranges");if(typeof n==="object"){var q=b.binarySearch.call(s,n,p,function(u,t){return u[t].range},function(t,v,u){if(t<v[u].range){if(u>0){if(t>=v[u-1].range){return 0}else{return -1}}else{return 0}}else{return 1}});o=1;if(q>-1){o=parseInt(n[q].value,10)}else{var r=n.length-1;if(p>=n[r].range){o=n[r].value}}}return o},notify_mouse_up_implicit:function(o){var s=this,r=e.get_current_min_value.call(s),q=e.get_current_max_value.call(s),n=false;if((s.data("beforestart_min")!==r)||(s.data("beforestart_max")!==q)){n=true;s.data("beforestart_min",r);s.data("beforestart_max",q)}var p=s.data("settings");p.user_mouseup_callback.call(s,e.get_current_min_value.call(s),e.get_current_max_value.call(s),o,n);return s},notify_changed_implicit:function(r,o,n){var s=this;var q=false;if(r==="init"||r==="refresh"){q=true}var t=e.get_current_min_value.call(s),p=e.get_current_max_value.call(s);if(!q){o=e.round_value_according_to_rounding.call(s,o);n=e.round_value_according_to_rounding.call(s,n)}if(q||t!==o||p!==n){b.notify_changed_explicit.call(s,r,o,n,t,p);q=1}return q},notify_changed_explicit:function(r,p,n,t,q){var s=this,o=s.data("settings");if(s.data("aria_enabled")){b.updateAriaAttributes.call(s)}o.value_changed_callback.call(s,r,t,q,p,n);return s},validate_params:function(p){var s=this;var o=s.data("range_min"),t=s.data("range_max"),r=s.data("cur_min"),u=s.data("lower-limit"),n=s.data("upper-limit");var q=b.haveLimits.call(s);if(typeof o==="undefined"){f.error("the data-range_min attribute was not defined")}if(typeof t==="undefined"){f.error("the data-range_max attribute was not defined")}if(typeof r==="undefined"){f.error("the data-cur_min attribute must be defined")}if(o>t){f.error("Invalid input parameter. must be min < max")}if(q&&u>n){f.error("Invalid data-lower-limit or data-upper-limit")}if(s.find(p.left_grip_selector).length===0){f.error("Cannot find element pointed by left_grip_selector: "+p.left_grip_selector)}if(typeof p.right_grip_selector!=="undefined"){if(s.find(p.right_grip_selector).length===0){f.error("Cannot find element pointed by right_grip_selector: "+p.right_grip_selector)}}if(typeof p.value_bar_selector!=="undefined"){if(s.find(p.value_bar_selector).length===0){f.error("Cannot find element pointed by value_bar_selector"+p.value_bar_selector)}}},rangemap_0_to_n:function(q,s){var p=this;var r=p.data("range_min");var o=p.data("range_max");if(q<=r){return 0}if(q>=o){return s}return Math.floor((s*q-s*r)/(o-r))},inverse_rangemap_0_to_n:function(q,n){var p=this;var s=p.data("range_min");var o=p.data("range_max");if(q<=0){return s}if(q>=n){return o}var r=(o-s)*q/n;return r+s}};var e={teardown:function(){var n=this;n.removeData();f(document).unbind("mousemove.nstSlider").unbind("mouseup.nstSlider");n.parent().unbind("mousedown.nstSlider").unbind("touchstart.nstSlider").unbind("touchmove.nstSlider").unbind("touchend.nstSlider");n.unbind("keydown.nstSlider").unbind("keyup.nstSlider");return n},init:function(n){var o=f.extend({animating_css_class:"nst-animating",touch_tolerance_value_bar_y:30,touch_tolerance_value_bar_x:15,left_grip_selector:".nst-slider-grip-left",right_grip_selector:undefined,highlight:undefined,rounding:undefined,value_bar_selector:undefined,crossable_handles:true,value_changed_callback:function(){},user_mouseup_callback:function(){},user_drag_start_callback:function(){}},n);var p=f(document);p.unbind("mouseup.nstSlider");p.unbind("mousemove.nstSlider");p.bind("mousemove.nstSlider",b.drag_move_func);p.bind("mouseup.nstSlider",b.drag_end_func);return this.each(function(){var z=f(this),D=z.parent();z.data("enabled",true);var r=z.data("range_min"),v=z.data("range_max"),w=z.data("cur_min"),C=z.data("cur_max");if(typeof C==="undefined"){C=w}if(r===""){r=0}if(v===""){v=0}if(w===""){w=0}if(C===""){C=0}z.data("range_min",r);z.data("range_max",v);z.data("cur_min",w);z.data("cur_max",C);b.validate_params.call(z,o);z.data("settings",o);if(typeof o.rounding!=="undefined"){e.set_rounding.call(z,o.rounding)}else{if(typeof z.data("rounding")!=="undefined"){e.set_rounding.call(z,z.data("rounding"))}else{e.set_rounding.call(z,1)}}var A=z.find(o.left_grip_selector)[0],x=f(A),y=f(z.find(o.right_grip_selector)[0]);if(typeof x.attr("tabindex")==="undefined"){x.attr("tabindex",0)}var q=false;if(z.find(o.right_grip_selector).length>0){q=true;if(typeof y.attr("tabindex")==="undefined"){y.attr("tabindex",0)}}z.data("has_right_grip",q);if(z.data("aria_enabled")===true){x.attr("role","slider").attr("aria-disabled","false");if(q){y.attr("role","slider").attr("aria-disabled","false")}}z.bind("keyup.nstSlider",function(G){if(z.data("enabled")){switch(G.which){case 37:case 38:case 39:case 40:if(k===l){var I=b.getSliderWidthPx.call(z),H,E,F;if(c-d<0){for(E=d;E<=I;E++){H=e.round_value_according_to_rounding.call(z,b.getSliderValuesAtPositionPx.call(z,E,E)[1]);if(H!==l){F=E;break}}}else{for(E=d;E>=0;E--){H=e.round_value_according_to_rounding.call(z,b.getSliderValuesAtPositionPx.call(z,E,E)[1]);if(H!==l){F=E;break}}}if(i){b.validateAndMoveGripsToPx.call(z,F,b.getRightGripPositionPx.call(z))}else{b.validateAndMoveGripsToPx.call(z,b.getLeftGripPositionPx.call(z),F)}b.notify_mouse_up_implicit.call(z,i)}}k=undefined;c=undefined;l=undefined;d=undefined}});z.bind("keydown.nstSlider",function(E){if(z.data("enabled")){var F=function(J,I){var H=b.getLeftGripPositionPx.call(z),G=b.getRightGripPositionPx.call(z);if(typeof k==="undefined"){c=i?H:G;k=i?e.get_current_min_value.call(z):e.get_current_max_value.call(z)}switch(I.which){case 37:case 40:if(i){H--}else{G--}I.preventDefault();break;case 38:case 39:if(i){H++}else{G++}I.preventDefault();break}d=i?H:G;b.validateAndMoveGripsToPx.call(z,H,G);l=i?e.get_current_min_value.call(z):e.get_current_max_value.call(z)};if(q&&z.find(":focus").is(y)){i=false;F.call(z,y,E)}else{i=true;F.call(z,x,E)}}});var t=b.getLeftGripWidth.call(z),u=q?b.getRightGripWidth.call(z):t;z.data("left_grip_width",t);z.data("right_grip_width",u);z.data("value_bar_selector",o.value_bar_selector);if(!q){var B=C===v||C===r;b.setNakedBarDelta.call(z,B?"stickToSides":"middle",t)}if(r===v||w===C){e.set_range.call(z,r,v)}else{b.set_position_from_val.call(z,z.data("cur_min"),z.data("cur_max"))}b.notify_changed_implicit.call(z,"init");z.data("beforestart_min",e.get_current_min_value.call(z));z.data("beforestart_max",e.get_current_max_value.call(z));z.bind("mousedown.nstSlider",function(E){b.drag_start_func.call(z,E,o,x,y,false)});D.bind("touchstart.nstSlider",function(E){b.drag_start_func_touch.call(z,E,o,x,y,true)});D.bind("touchend.nstSlider",function(E){b.drag_end_func_touch.call(z,E)});D.bind("touchmove.nstSlider",function(E){b.drag_move_func_touch.call(z,E)});var s=z.data("histogram");if(typeof s!=="undefined"){e.set_step_histogram.call(z,s)}})},get_range_min:function(){var n=this;return n.data("range_min")},get_range_max:function(){var n=this;return n.data("range_max")},get_current_min_value:function(){var p=f(this);var r=e.get_range_min.call(p),o=e.get_range_max.call(p);var q=p.data("cur_min");var n;if(r>=q){n=r}else{n=e.round_value_according_to_rounding.call(p,q)}if(b.haveLimits.call(p)){if(n<=r){return p.data("lower-limit")}else{if(n>=o){return p.data("upper-limit")}}}else{if(n<=r){return r}else{if(n>=o){return o}}}return n},get_current_max_value:function(){var q=f(this);var r=e.get_range_min.call(q),p=e.get_range_max.call(q);var o=q.data("cur_max");var n;if(p<=o){n=p}else{n=e.round_value_according_to_rounding.call(q,o)}if(b.haveLimits.call(q)){if(n>=p){return q.data("upper-limit")}else{if(n<=r){return q.data("lower-limit")}}}else{if(n>=p){return p}else{if(n<=r){return r}}}return n},is_handle_to_left_extreme:function(){var n=this;if(b.haveLimits.call(n)){return n.data("lower-limit")===e.get_current_min_value.call(n)}else{return e.get_range_min.call(n)===e.get_current_min_value.call(n)}},is_handle_to_right_extreme:function(){var n=this;if(b.haveLimits.call(n)){return n.data("upper-limit")===e.get_current_max_value.call(n)}else{return e.get_range_max.call(n)===e.get_current_max_value.call(n)}},refresh:function(){var p=this;var o=p.data("last_step_histogram");if(typeof o!=="undefined"){e.set_step_histogram.call(p,o)}b.set_position_from_val.call(p,e.get_current_min_value.call(p),e.get_current_max_value.call(p));var n=p.data("highlightedRangeMin");if(typeof n==="number"){var q=p.data("highlightedRangeMax");e.highlight_range.call(p,n,q)}b.notify_changed_implicit.call(p,"refresh");return p},disable:function(){var o=this,n=o.data("settings");o.data("enabled",false).find(n.left_grip_selector).attr("aria-disabled","true").end().find(n.right_grip_selector).attr("aria-disabled","true");return o},enable:function(){var o=this,n=o.data("settings");o.data("enabled",true).find(n.left_grip_selector).attr("aria-disabled","false").end().find(n.right_grip_selector).attr("aria-disabled","false");return o},is_enabled:function(){var n=this;return n.data("enabled")},set_position:function(p,n){var q=this;var o=q.data("cur_min"),r=q.data("cur_max");if(p>n){b.set_position_from_val.call(q,n,p)}else{b.set_position_from_val.call(q,p,n)}b.refresh_grips_style.call(q);b.notify_changed_implicit.call(q,"set_position",o,r);q.data("beforestart_min",p);q.data("beforestart_max",n)},set_step_histogram:function(D){var q=this;q.data("last_step_histogram",D);if(typeof D==="undefined"){f.error("got an undefined histogram in set_step_histogram");b.unset_step_histogram.call(q)}var G=b.getSliderWidthPx.call(q)-q.data("left_grip_width"),E=D.length;if(G<=0){return}var y;var B=0;for(y=0;y<E;y++){B+=D[y]}if(B===0){e.unset_step_histogram.call(q);return q}var n=parseFloat(B)/G;for(y=0;y<E;y++){D[y]=D[y]/n}var v=[D[0]];for(y=1;y<E;y++){var o=v[y-1]+D[y];v.push(o)}v.push(G);var A=[q.data("range_min")];var C=0;var r=A[0];var x=0;while(C<=G){var z=parseInt(v.shift(),10);var u=b.inverse_rangemap_0_to_n.call(q,x+1,E+1);x++;var w=z-C;var t=u-r;for(y=C;y<z;y++){var F=r+(t*(y-C+1)/w);A.push(F);C++;r=F}if(C===G){break}}A[A.length-1]=q.data("range_max");var s=function(H){return A[parseInt(H,10)]};var p=function(I){var H=b.binarySearch.call(q,A,I,function(J,K){return J[K]},b.binarySearchValueToPxCompareFunc);if(A[H]===I){return H}if(Math.abs(A[H-1]-I)<Math.abs(A[H]-I)){return H-1}return H};q.data("pixel_to_value_mapping",s);q.data("value_to_pixel_mapping",p);return q},unset_step_histogram:function(){var n=this;n.removeData("pixel_to_value_mapping");n.removeData("value_to_pixel_mapping");n.removeData("last_step_histogram");return n},set_range:function(r,o){var q=this;var p=e.get_current_min_value.call(q),n=e.get_current_max_value.call(q);q.data("range_min",r);q.data("range_max",o);b.set_position_from_val.call(q,p,n);b.notify_changed_implicit.call(q,"set_range",p,n);return q},highlight_range:function(u,s){var t=this;var r=t.data("settings");if(typeof r.highlight==="undefined"){f.error('you cannot call highlight_range if you haven\' specified the "highlight" parameter in construction!')}if(!u){u=0}if(!s){s=0}var o=e.value_to_px.call(t,u),p=e.value_to_px.call(t,s),q=p-o+t.data("left_grip_width");var n=t.find(r.highlight.panel_selector);n.css("left",o+"px");n.css("width",q+"px");t.data("highlightedRangeMin",u);t.data("highlightedRangeMax",s);b.refresh_grips_style.call(t);return t},set_rounding:function(n){var q=this;if(typeof n==="string"&&n.indexOf("{")>-1){n=f.parseJSON(n)}q.data("rounding",n);var p=[];if(typeof n==="object"){var r;for(r in n){if(n.hasOwnProperty(r)){var o=n[r];p.push({range:o,value:r})}}p.sort(function(t,s){return t.range-s.range});q.data("rounding_ranges",p)}else{q.removeData("rounding_ranges")}return q},get_rounding:function(){var n=this;return n.data("rounding")},round_value_according_to_rounding:function(q){var s=this;var p=b.get_rounding_for_value.call(s,q);if(p>0){var o=q/p;var r=parseInt(o,10);var t=o-r;if(t>0.5){r++}var n=r*p;return n}else{f.error("rounding must be > 0, got "+p+" instead")}return q},value_to_px:function(p){var q=this,o=q.data("value_to_pixel_mapping");if(typeof o!=="undefined"){return o(p)}var n=b.getSliderWidthPx.call(q)-q.data("left_grip_width");return b.rangemap_0_to_n.call(q,p,n)}};var a="nstSlider";f.fn[a]=function(n){if(e[n]){if(this.data("initialized")===true){return e[n].apply(this,Array.prototype.slice.call(arguments,1))}else{throw new Error("method "+n+" called on an uninitialized instance of "+a)}}else{if(typeof n==="object"||!n){this.data("initialized",true);return e.init.apply(this,arguments)}else{f.error("Cannot call method "+n)}}}})(jQuery);