/*!
 * jquery.sumoselect - v3.0.2
 * http://hemantnegi.github.io/jquery.sumoselect
 * 2014-04-08
 *
 * Copyright 2015 Hemant Negi
 * Email : hemant.frnz@gmail.com
 * Compressor http://refresh-sf.com/
 */
(function(b){b.fn.SumoSelect=function(f){var e=b.extend({placeholder:"Select Here",csvDispCount:3,captionFormat:"{0} Selected",captionFormatAllSelected:"{0} all selected!",floatWidth:400,forceCustomRendering:false,nativeOnDevice:["Android","BlackBerry","iPhone","iPad","iPod","Opera Mini","IEMobile","Silk"],outputAsCSV:false,csvSepChar:",",okCancelInMulti:false,triggerChangeCombined:true,selectAll:false,search:false,searchText:"Search...",noMatch:'No matches for "{0}"',prefix:"",locale:["OK","Cancel","Select All"],up:false},f);var a=this.each(function(){var c=this;if(this.sumo||!b(this).is("select")){return}this.sumo={E:b(c),is_multi:b(c).attr("multiple"),select:"",caption:"",placeholder:"",optDiv:"",CaptionCont:"",ul:"",is_floating:false,is_opened:false,mob:false,Pstate:[],createElems:function(){var d=this;d.E.wrap('<div class="SumoSelect" tabindex="0">');d.select=d.E.parent();d.caption=b("<span>");d.CaptionCont=b('<p class="CaptionCont"><label><i></i></label></p>').addClass("SelectBox").attr("style",d.E.attr("style")).prepend(d.caption);d.select.append(d.CaptionCont);if(!d.is_multi){e.okCancelInMulti=false}if(d.E.attr("disabled")){d.select.addClass("disabled").removeAttr("tabindex")}if(e.outputAsCSV&&d.is_multi&&d.E.attr("name")){d.select.append(b('<input class="HEMANT123" type="hidden" />').attr("name",d.E.attr("name")).val(d.getSelStr()));d.E.removeAttr("name")}if(d.isMobile()&&!e.forceCustomRendering){d.setNativeMobile();return}if(d.E.attr("name")){d.select.addClass("sumo_"+d.E.attr("name"))}d.E.addClass("SumoUnder").attr("tabindex","-1");d.optDiv=b('<div class="optWrapper '+(e.up?"up":"")+'">');d.floatingList();d.ul=b('<ul class="options">');d.optDiv.append(d.ul);if(e.selectAll){d.SelAll()}if(e.search){d.Search()}d.ul.append(d.prepItems(d.E.children()));if(d.is_multi){d.multiSelelect()}d.select.append(d.optDiv);d.basicEvents();d.selAllState()},prepItems:function(l,d){var m=[],k=this;b(l).each(function(g,h){h=b(h);m.push(h.is("optgroup")?b('<li class="group '+(h[0].disabled?"disabled":"")+'"><label>'+h.attr("label")+"</label><ul></ul><li>").find("ul").append(k.prepItems(h.children(),h[0].disabled)).end():k.createLi(h,d))});return m},createLi:function(k,d){var j=this;if(!k.attr("value")){k.attr("value",k.val())}li=b('<li class="opt"><label>'+k.text()+"</label></li>");li.data("opt",k);k.data("li",li);if(j.is_multi){li.prepend("<span><i></i></span>")}if(k[0].disabled||d){li=li.addClass("disabled")}j.onOptClick(li);if(k[0].selected){li.addClass("selected")}if(k.attr("class")){li.addClass(k.attr("class"))}return li},getSelStr:function(){sopt=[];this.E.find("option:selected").each(function(){sopt.push(b(this).val())});return sopt.join(e.csvSepChar)},multiSelelect:function(){var d=this;d.optDiv.addClass("multiple");d.okbtn=b('<p class="btnOk">'+e.locale[0]+"</p>").click(function(){if(e.triggerChangeCombined){changed=false;if(d.E.find("option:selected").length!=d.Pstate.length){changed=true}else{d.E.find("option").each(function(k,j){if(j.selected&&d.Pstate.indexOf(k)<0){changed=true}})}if(changed){d.callChange();d.setText()}}d.hideOpts()});d.cancelBtn=b('<p class="btnCancel">'+e.locale[1]+"</p>").click(function(){d._cnbtn();d.hideOpts()});d.optDiv.append(b('<div class="MultiControls">').append(d.okbtn).append(d.cancelBtn))},_cnbtn:function(){var d=this;d.E.find("option:selected").each(function(){this.selected=false});d.optDiv.find("li.selected").removeClass("selected");for(var h=0;h<d.Pstate.length;h++){d.E.find("option")[d.Pstate[h]].selected=true;d.ul.find("li.opt").eq(d.Pstate[h]).addClass("selected")}d.selAllState()},SelAll:function(){var d=this;if(!d.is_multi){return}d.selAll=b('<p class="select-all"><span><i></i></span><label>'+e.locale[2]+"</label></p>");d.selAll.on("click",function(){d.selAll.toggleClass("selected");d.optDiv.find("li.opt").not(".hidden").each(function(k,j){j=b(j);if(d.selAll.hasClass("selected")){if(!j.hasClass("selected")){j.trigger("click")}}else{if(j.hasClass("selected")){j.trigger("click")}}})});d.optDiv.prepend(d.selAll)},Search:function(){var j=this,d=j.CaptionCont.addClass("search"),k=b('<p class="no-match">');j.ftxt=b('<input type="text" class="search-txt" value="" placeholder="'+e.searchText+'">').on("click",function(g){g.stopPropagation()});d.append(j.ftxt);j.optDiv.children("ul").after(k);j.ftxt.on("keyup.sumo",function(){var g=j.optDiv.find("ul.options li.opt").each(function(m,h){h=b(h);if(h.text().toLowerCase().indexOf(j.ftxt.val().toLowerCase())>-1){h.removeClass("hidden")}else{h.addClass("hidden")}}).not(".hidden");k.html(e.noMatch.replace(/\{0\}/g,j.ftxt.val())).toggle(!g.length);j.selAllState()})},selAllState:function(){var j=this;if(e.selectAll){var d=0,k=0;j.optDiv.find("li.opt").not(".hidden").each(function(h,g){if(b(g).hasClass("selected")){d++}if(!b(g).hasClass("disabled")){k++}});if(d==k){j.selAll.removeClass("partial").addClass("selected")}else{if(d==0){j.selAll.removeClass("selected partial")}else{j.selAll.addClass("partial")}}}},showOpts:function(){var d=this;if(d.E.attr("disabled")){return}d.is_opened=true;d.select.addClass("open");if(d.ftxt){d.ftxt.focus()}else{d.select.focus()}b(document).on("click.sumo",function(h){if(!d.select.is(h.target)&&d.select.has(h.target).length===0){if(!d.is_opened){return}d.hideOpts();if(e.okCancelInMulti){d._cnbtn()}}});if(d.is_floating){H=d.optDiv.children("ul").outerHeight()+2;if(d.is_multi){H=H+parseInt(d.optDiv.css("padding-bottom"))}d.optDiv.css("height",H);b("body").addClass("sumoStopScroll")}d.setPstate()},setPstate:function(){var d=this;if(d.is_multi&&(d.is_floating||e.okCancelInMulti)){d.Pstate=[];d.E.find("option").each(function(k,j){if(j.selected){d.Pstate.push(k)}})}},callChange:function(){this.E.trigger("change").trigger("click")},hideOpts:function(){var d=this;if(d.is_opened){d.is_opened=false;d.select.removeClass("open").find("ul li.sel").removeClass("sel");b(document).off("click.sumo");d.select.focus();b("body").removeClass("sumoStopScroll");if(e.search){d.ftxt.val("");d.optDiv.find("ul.options li").removeClass("hidden");d.optDiv.find(".no-match").toggle(false)}}},setOnOpen:function(){var d=this,h=d.optDiv.find("li.opt:not(.hidden)").eq(e.search?0:d.E[0].selectedIndex);d.optDiv.find("li.sel").removeClass("sel");h.addClass("sel");d.showOpts()},nav:function(v){var u=this,s,d=u.ul.find("li.opt:not(.disabled, .hidden)"),w=u.ul.find("li.opt.sel:not(.hidden)"),r=d.index(w);if(u.is_opened&&w.length){if(v&&r>0){s=d.eq(r-1)}else{if(!v&&r<d.length-1&&r>-1){s=d.eq(r+1)}else{return}}w.removeClass("sel");w=s.addClass("sel");var t=u.ul,p=t.scrollTop(),q=w.position().top+p;if(q>=p+t.height()-w.outerHeight()){t.scrollTop(q-t.height()+w.outerHeight())}if(q<p){t.scrollTop(q)}}else{u.setOnOpen()}},basicEvents:function(){var d=this;d.CaptionCont.click(function(h){d.E.trigger("click");if(d.is_opened){d.hideOpts()}else{d.showOpts()}h.stopPropagation()});d.select.on("keydown.sumo",function(h){switch(h.which){case 38:d.nav(true);break;case 40:d.nav(false);break;case 32:if(e.search&&d.ftxt.is(h.target)){return}case 13:if(d.is_opened){d.optDiv.find("ul li.sel").trigger("click")}else{d.setOnOpen()}break;case 9:case 27:if(e.okCancelInMulti){d._cnbtn()}d.hideOpts();return;default:return}h.preventDefault()});b(window).on("resize.sumo",function(){d.floatingList()})},onOptClick:function(h){var d=this;h.click(function(){var g=b(this);if(g.hasClass("disabled")){return}txt="";if(d.is_multi){g.toggleClass("selected");g.data("opt")[0].selected=g.hasClass("selected");d.selAllState()}else{g.parent().find("li.selected").removeClass("selected");g.toggleClass("selected");g.data("opt")[0].selected=true}if(!(d.is_multi&&e.triggerChangeCombined&&(d.is_floating||e.okCancelInMulti))){d.setText();d.callChange()}if(!d.is_multi){d.hideOpts()}})},setText:function(){var d=this;d.placeholder="";if(d.is_multi){sels=d.E.find(":selected").not(":disabled");for(i=0;i<sels.length;i++){if(i+1>=e.csvDispCount&&e.csvDispCount){if(sels.length==d.E.find("option").length&&e.captionFormatAllSelected){d.placeholder=e.captionFormatAllSelected.replace(/\{0\}/g,sels.length)+","}else{d.placeholder=e.captionFormat.replace(/\{0\}/g,sels.length)+","}break}else{d.placeholder+=b(sels[i]).text()+", "}}d.placeholder=d.placeholder.replace(/,([^,]*)$/,"$1")}else{d.placeholder=d.E.find(":selected").not(":disabled").text()}is_placeholder=false;if(!d.placeholder){is_placeholder=true;d.placeholder=d.E.attr("placeholder");if(!d.placeholder){d.placeholder=d.E.find("option:disabled:selected").text()}}d.placeholder=d.placeholder?(e.prefix+" "+d.placeholder):e.placeholder;d.caption.html(d.placeholder);d.CaptionCont.attr("title",d.placeholder);csvField=d.select.find("input.HEMANT123");if(csvField.length){csvField.val(d.getSelStr())}if(is_placeholder){d.caption.addClass("placeholder")}else{d.caption.removeClass("placeholder")}return d.placeholder},isMobile:function(){var d=navigator.userAgent||navigator.vendor||window.opera;for(var h=0;h<e.nativeOnDevice.length;h++){if(d.toString().toLowerCase().indexOf(e.nativeOnDevice[h].toLowerCase())>0){return e.nativeOnDevice[h]}}return false},setNativeMobile:function(){var d=this;d.E.addClass("SelectClass");d.mob=true;d.E.change(function(){d.setText()})},floatingList:function(){var d=this;d.is_floating=b(window).width()<=e.floatWidth;d.optDiv.toggleClass("isFloating",d.is_floating);if(!d.is_floating){d.optDiv.css("height","")}d.optDiv.toggleClass("okCancelInMulti",e.okCancelInMulti&&!d.is_floating)},vRange:function(h){var d=this;opts=d.E.find("option");if(opts.length<=h||h<0){throw"index out of bounds"}return d},toggSel:function(d,k){var j=this;if(typeof(k)==="number"){j.vRange(k);opt=j.E.find("option")[k]}else{opt=j.E.find('option[value="'+k+'"]')[0]||0}if(!opt||opt.disabled){return}if(opt.selected!=d){opt.selected=d;if(!j.mob){b(opt).data("li").toggleClass("selected",d)}j.callChange();j.setPstate();j.setText();j.selAllState()}},toggDis:function(d,k){var j=this.vRange(k);j.E.find("option")[k].disabled=d;if(d){j.E.find("option")[k].selected=false}if(!j.mob){j.optDiv.find("ul.options li").eq(k).toggleClass("disabled",d).removeClass("selected")}j.setText()},toggSumo:function(d){var h=this;h.enabled=d;h.select.toggleClass("disabled",d);if(d){h.E.attr("disabled","disabled");h.select.removeAttr("tabindex")}else{h.E.removeAttr("disabled");h.select.attr("tabindex","0")}return h},toggSelAll:function(d){var h=this;h.E.find("option").each(function(k,g){if(h.E.find("option")[b(this).index()].disabled){return}h.E.find("option")[b(this).index()].selected=d;if(!h.mob){h.optDiv.find("ul.options li").eq(b(this).index()).toggleClass("selected",d)}h.setText()});if(!h.mob&&h.selAll){h.selAll.removeClass("partial").toggleClass("selected",d)}h.callChange();h.setPstate()},reload:function(){var d=this.unload();return b(d).SumoSelect(e)},unload:function(){var d=this;d.select.before(d.E);d.E.show();if(e.outputAsCSV&&d.is_multi&&d.select.find("input.HEMANT123").length){d.E.attr("name",d.select.find("input.HEMANT123").attr("name"))}d.select.remove();delete c.sumo;return c},add:function(d,m,l){if(typeof d=="undefined"){throw"No value to add"}var k=this;opts=k.E.find("option");if(typeof m=="number"){l=m;m=d}if(typeof m=="undefined"){m=d}opt=b("<option></option>").val(d).html(m);if(opts.length<l){throw"index out of bounds"}if(typeof l=="undefined"||opts.length==l){k.E.append(opt);if(!k.mob){k.ul.append(k.createLi(opt))}}else{opts.eq(l).before(opt);if(!k.mob){k.ul.find("li.opt").eq(l).before(k.createLi(opt))}}return c},remove:function(h){var d=this.vRange(h);d.E.find("option").eq(h).remove();if(!d.mob){d.optDiv.find("ul.options li").eq(h).remove()}d.setText()},selectItem:function(d){this.toggSel(true,d)},unSelectItem:function(d){this.toggSel(false,d)},selectAll:function(){this.toggSelAll(true)},unSelectAll:function(){this.toggSelAll(false)},disableItem:function(d){this.toggDis(true,d)},enableItem:function(d){this.toggDis(false,d)},enabled:true,enable:function(){return this.toggSumo(false)},disable:function(){return this.toggSumo(true)},init:function(){var d=this;d.createElems();d.setText();return d}};c.sumo.init()});return a.length==1?a[0]:a}}(jQuery));