/*! Nestoria Slider - v1.0.13 - 2015-07-16
* http://lokku.github.io/jquery-nstslider/
* Copyright (c) 2015 Lokku Ltd.; Licensed MIT */
(function(u){var s;var n;var q;var r;var p;var x;var o;var w;var t;var y={setNakedBarDelta:function(b,a){if(b==="stickToSides"){t={toEndWidth:a,toBeginLeft:0,toBeginWidth:a}}else{if(b==="middle"){t={toEndWidth:a/2,toBeginLeft:a/2,toBeginWidth:a/2}}else{throw new Error("unknown position of setNakedBarDelta: "+b)}}},getSliderValuesAtPositionPx:function(g,d){var a=this,c,e,b=a.data("pixel_to_value_mapping");if(typeof b!=="undefined"){c=b(g);e=b(d)}else{var f=y.getSliderWidthPx.call(a)-a.data("left_grip_width");c=y.inverse_rangemap_0_to_n.call(a,g,f);e=y.inverse_rangemap_0_to_n.call(a,d,f)}return[c,e]},validateAndMoveGripsToPx:function(c,e){var b=this;var a=y.getSliderWidthPx.call(b)-b.data("left_grip_width");if(e<=a&&c>=0&&c<=a&&(!b.data("has_right_grip")||c<=e)){var d=b.data("cur_min"),f=b.data("cur_max");y.set_position_from_px.call(b,c,e);y.refresh_grips_style.call(b);y.notify_changed_implicit.call(b,"drag_move",d,f)}return b},updateAriaAttributes:function(){var a=this,b=a.data("settings"),d=a.find(b.left_grip_selector);if(a.data("has_right_grip")){var c=a.find(b.right_grip_selector);d.attr("aria-valuemin",a.data("range_min")).attr("aria-valuenow",v.get_current_min_value.call(a)).attr("aria-valuemax",v.get_current_max_value.call(a));c.attr("aria-valuemin",v.get_current_min_value.call(a)).attr("aria-valuenow",v.get_current_max_value.call(a)).attr("aria-valuemax",a.data("range_max"))}else{d.attr("aria-valuemin",a.data("range_min")).attr("aria-valuenow",v.get_current_min_value.call(a)).attr("aria-valuemax",a.data("range_max"))}return a},getSliderWidthPx:function(){var a=this;return Math.round(a.width())},getGripPositionPx:function(a){return parseInt(a.css("left").replace("px",""),10)},getLeftGripPositionPx:function(){var a=this,b=a.data("settings"),c=a.find(b.left_grip_selector);return y.getGripPositionPx.call(a,c)},getRightGripPositionPx:function(){var a=this,b=a.data("settings");if(a.data("has_right_grip")){return y.getGripPositionPx.call(a,a.find(b.right_grip_selector))}var c=y.getSliderWidthPx.call(a)-a.data("left_grip_width");return y.rangemap_0_to_n.call(a,a.data("cur_max"),c)},getLeftGripWidth:function(){var a=this,b=a.data("settings"),c=a.find(b.left_grip_selector);return Math.round(c.outerWidth())},getRightGripWidth:function(){var a=this,b=a.data("settings"),c=a.find(b.right_grip_selector);return Math.round(c.outerWidth())},binarySearchValueToPxCompareFunc:function(a,c,b){if(a===c[b]){return 0}if(a<c[b]&&b===0){return 0}if(c[b-1]<=a&&a<c[b]){return 0}if(a>c[b]){return 1}if(a<=c[b-1]){return -1}u.error("cannot compare s: "+a+" with a["+b+"]. a is: "+c.join(","))},binarySearch:function(h,f,c,d){var a=0;var b=h.length-1;var g;var i;while(a<=b){g=(a+b)/2|0;i=c(h,g);var e=d(f,h,g);if(e>0){a=g+1}else{if(e<0){b=g-1}else{return g}}}return -1},haveLimits:function(){var a=this,c=a.data("lower-limit"),d=a.data("upper-limit"),b=false;if(typeof c!=="undefined"&&typeof d!=="undefined"){b=true}return b},refresh_grips_style:function(){var h=this,a=h.data("settings");if(typeof a.highlight==="undefined"){return}var b=h.data("highlightedRangeMin");if(typeof b==="undefined"){return}var e=h.find(a.left_grip_selector),g=h.find(a.right_grip_selector),i=h.data("highlightedRangeMax"),f=h.data("cur_min"),c=h.data("cur_max"),d=a.highlight.grip_class;if(f<b||f>i){e.removeClass(d)}else{e.addClass(d)}if(c<b||c>i){g.removeClass(d)}else{g.addClass(d)}},set_position_from_val:function(c,d){var b=this;var e=b.data("range_min"),a=b.data("range_max");if(c<e){c=e}if(c>a){c=a}if(b.data("has_right_grip")){if(d>a){d=a}if(d<e){d=e}}else{d=b.data("cur_max")}var g=v.value_to_px.call(b,c),f=v.value_to_px.call(b,d);y.set_handles_at_px.call(b,g,f);b.data("cur_min",c);if(b.data("has_right_grip")){b.data("cur_max",d)}return b},set_position_from_px:function(f,d){var a=this;y.set_handles_at_px.call(a,f,d);var c=y.getSliderValuesAtPositionPx.call(a,f,d),b=c[0],e=c[1];a.data("cur_min",b);if(a.data("has_right_grip")){a.data("cur_max",e)}return a},set_handles_at_px:function(g,e){var a=this;var d=a.data("settings");var b=d.left_grip_selector,h=d.right_grip_selector,c=d.value_bar_selector;var f=a.data("left_grip_width");a.find(b).css("left",g+"px");a.find(h).css("left",e+"px");if(a.data("has_right_grip")){a.find(c).css("left",g+"px").css("width",(e-g+f)+"px")}else{if(!t){y.populateNakedBarDeltas.call(a,g,e,f)}if(e>g){a.find(c).css("left",g+"px").css("width",e-g+t.toEndWidth+"px")}else{a.find(c).css("left",e+t.toBeginLeft+"px").css("width",(g-e+t.toBeginWidth)+"px")}}return a},drag_start_func_touch:function(i,B,j,h,a){var g=this,k=i.originalEvent,l=k.touches[0];var e=l.pageY,c=l.pageX;var d=Math.abs(g.offset().top-e),m=g.offset().left,b=m-c,f=c-(m+g.width());if(d>B.touch_tolerance_value_bar_y||b>B.touch_tolerance_value_bar_x||f>B.touch_tolerance_value_bar_x){return}k.preventDefault();q=l.pageX;y.drag_start_func.call(g,l,B,j,h,a)},drag_start_func:function(K,I,J,L,m){var k=this;k.find(I.left_grip_selector+","+I.value_bar_selector+","+I.right_grip_selector).removeClass(I.animating_css_class);if(!v.is_enabled.call(k)){return}var M=u(K.target);var d=false;if(typeof I.highlight==="object"){d=M.is(I.highlight.panel_selector)}if(m===false&&!M.is(I.left_grip_selector)&&!M.is(I.right_grip_selector)&&!M.is(I.value_bar_selector)&&!d&&!M.is(k)){return}s=k;var i=y.getGripPositionPx.call(k,J),f=y.getSliderWidthPx.call(k)-k.data("left_grip_width"),a=J.offset().left,h,j,H,g,N,l;var b=y.getRightGripPositionPx.call(k);j=Math.round(K.pageX)-(k.data("left_grip_width")/2);H=Math.abs(a-j);N=j-a;if(k.data("has_right_grip")){h=L.offset().left;g=Math.abs(h-j);l=j-h}else{g=H*2;l=N*2}I.user_drag_start_callback.call(k,K);if(H===g){if(j<a){i+=N;r=true}else{b+=l;r=false}}else{if(H<g){i+=N;r=true}else{b+=l;r=false}}if(k.data("has_right_grip")){if(b>f){b=f}}else{if(i>f){i=f}}if(i<0){i=0}n=true;var e=k.data("cur_min"),c=k.data("cur_max");y.set_position_from_px.call(k,i,b);y.refresh_grips_style.call(k);y.notify_changed_implicit.call(k,"drag_start",e,c);if(Object.prototype.toString.apply(K)!=="[object Touch]"){K.preventDefault()}},drag_move_func_touch:function(c){if(n===true){var b=c.originalEvent;b.preventDefault();var a=b.touches[0];y.drag_move_func(a)}},drag_move_func:function(k){if(n){var i=s,d=i.data("settings"),b=y.getSliderWidthPx.call(i)-i.data("left_grip_width"),a=y.getLeftGripPositionPx.call(i);var C=y.getRightGripPositionPx.call(i);var D=Math.round(k.pageX);var f=D-q;var e=i.data("left_grip_width")/2,g=i.offset().left+i.data("left_grip_width")-e,j=g+b;if(d.crossable_handles===false&&i.data("has_right_grip")){if(r){j=g+C}else{g=g+a}}var c=0,l=0;if(D<g){c=1;l=0}if(D>j){l=1;c=0}if(d.crossable_handles===true&&i.data("has_right_grip")){if(r){if(C<=b){if(a+f>C){r=false;a=C}}}else{if(a>=0){if(C+f<a){r=true;C=a}}}}var m=a,h=C;if((f>0&&!c)||(f<0&&!l)){if(r){m+=f}else{h+=f}}y.validateAndMoveGripsToPx.call(i,m,h);q=D;if(Object.prototype.toString.apply(k)!=="[object Touch]"){k.preventDefault()}}},drag_end_func_touch:function(c){var b=c.originalEvent;b.preventDefault();var a=b.touches[0];y.drag_end_func(a)},drag_end_func:function(){var a=s;if(typeof a!=="undefined"){n=false;q=undefined;y.notify_mouse_up_implicit.call(a,r);s=undefined;var b=a.data("settings");a.find(b.left_grip_selector+","+b.value_bar_selector+","+b.right_grip_selector).addClass(b.animating_css_class)}},get_rounding_for_value:function(d){var a=this;var e=a.data("rounding");var f=a.data("rounding_ranges");if(typeof f==="object"){var c=y.binarySearch.call(a,f,d,function(g,h){return g[h].range},function(i,g,h){if(i<g[h].range){if(h>0){if(i>=g[h-1].range){return 0}else{return -1}}else{return 0}}else{return 1}});e=1;if(c>-1){e=parseInt(f[c].value,10)}else{var b=f.length-1;if(d>=f[b].range){e=f[b].value}}}return e},notify_mouse_up_implicit:function(e){var a=this,b=v.get_current_min_value.call(a),c=v.get_current_max_value.call(a),f=false;if((a.data("beforestart_min")!==b)||(a.data("beforestart_max")!==c)){f=true;a.data("beforestart_min",b);a.data("beforestart_max",c)}var d=a.data("settings");d.user_mouseup_callback.call(a,v.get_current_min_value.call(a),v.get_current_max_value.call(a),e,f);return a},notify_changed_implicit:function(c,f,g){var b=this;var d=false;if(c==="init"||c==="refresh"){d=true}var a=v.get_current_min_value.call(b),e=v.get_current_max_value.call(b);if(!d){f=v.round_value_according_to_rounding.call(b,f);g=v.round_value_according_to_rounding.call(b,g)}if(d||a!==f||e!==g){y.notify_changed_explicit.call(b,c,f,g,a,e);d=1}return d},notify_changed_explicit:function(c,e,g,a,d){var b=this,f=b.data("settings");if(b.data("aria_enabled")){y.updateAriaAttributes.call(b)}f.value_changed_callback.call(b,c,a,d,e,g);return b},validate_params:function(f){var c=this;var g=c.data("range_min"),b=c.data("range_max"),d=c.data("cur_min"),a=c.data("lower-limit"),h=c.data("upper-limit");var e=y.haveLimits.call(c);if(typeof g==="undefined"){u.error("the data-range_min attribute was not defined")}if(typeof b==="undefined"){u.error("the data-range_max attribute was not defined")}if(typeof d==="undefined"){u.error("the data-cur_min attribute must be defined")}if(g>b){u.error("Invalid input parameter. must be min < max")}if(e&&a>h){u.error("Invalid data-lower-limit or data-upper-limit")}if(c.find(f.left_grip_selector).length===0){u.error("Cannot find element pointed by left_grip_selector: "+f.left_grip_selector)}if(typeof f.right_grip_selector!=="undefined"){if(c.find(f.right_grip_selector).length===0){u.error("Cannot find element pointed by right_grip_selector: "+f.right_grip_selector)}}if(typeof f.value_bar_selector!=="undefined"){if(c.find(f.value_bar_selector).length===0){u.error("Cannot find element pointed by value_bar_selector"+f.value_bar_selector)}}},rangemap_0_to_n:function(c,a){var d=this;var b=d.data("range_min");var e=d.data("range_max");if(c<=b){return 0}if(c>=e){return a}return Math.floor((a*c-a*b)/(e-b))},inverse_rangemap_0_to_n:function(c,f){var d=this;var a=d.data("range_min");var e=d.data("range_max");if(c<=0){return a}if(c>=f){return e}var b=(e-a)*c/f;return b+a}};var v={teardown:function(){var a=this;a.removeData();u(document).unbind("mousemove.nstSlider").unbind("mouseup.nstSlider");a.parent().unbind("mousedown.nstSlider").unbind("touchstart.nstSlider").unbind("touchmove.nstSlider").unbind("touchend.nstSlider");a.unbind("keydown.nstSlider").unbind("keyup.nstSlider");return a},init:function(c){var b=u.extend({animating_css_class:"nst-animating",touch_tolerance_value_bar_y:30,touch_tolerance_value_bar_x:15,left_grip_selector:".nst-slider-grip-left",right_grip_selector:undefined,highlight:undefined,rounding:undefined,value_bar_selector:undefined,crossable_handles:true,value_changed_callback:function(){},user_mouseup_callback:function(){},user_drag_start_callback:function(){}},c);var a=u(document);a.unbind("mouseup.nstSlider");a.unbind("mousemove.nstSlider");a.bind("mousemove.nstSlider",y.drag_move_func);a.bind("mouseup.nstSlider",y.drag_end_func);return this.each(function(){var j=u(this),d=j.parent();j.data("enabled",true);var e=j.data("range_min"),E=j.data("range_max"),m=j.data("cur_min"),g=j.data("cur_max");if(typeof g==="undefined"){g=m}if(e===""){e=0}if(E===""){E=0}if(m===""){m=0}if(g===""){g=0}j.data("range_min",e);j.data("range_max",E);j.data("cur_min",m);j.data("cur_max",g);y.validate_params.call(j,b);j.data("settings",b);if(typeof b.rounding!=="undefined"){v.set_rounding.call(j,b.rounding)}else{if(typeof j.data("rounding")!=="undefined"){v.set_rounding.call(j,j.data("rounding"))}else{v.set_rounding.call(j,1)}}var i=j.find(b.left_grip_selector)[0],l=u(i),k=u(j.find(b.right_grip_selector)[0]);if(typeof l.attr("tabindex")==="undefined"){l.attr("tabindex",0)}var f=false;if(j.find(b.right_grip_selector).length>0){f=true;if(typeof k.attr("tabindex")==="undefined"){k.attr("tabindex",0)}}j.data("has_right_grip",f);if(j.data("aria_enabled")===true){l.attr("role","slider").attr("aria-disabled","false");if(f){k.attr("role","slider").attr("aria-disabled","false")}}j.bind("keyup.nstSlider",function(C){if(j.data("enabled")){switch(C.which){case 37:case 38:case 39:case 40:if(p===o){var A=y.getSliderWidthPx.call(j),B,J,D;if(x-w<0){for(J=w;J<=A;J++){B=v.round_value_according_to_rounding.call(j,y.getSliderValuesAtPositionPx.call(j,J,J)[1]);if(B!==o){D=J;break}}}else{for(J=w;J>=0;J--){B=v.round_value_according_to_rounding.call(j,y.getSliderValuesAtPositionPx.call(j,J,J)[1]);if(B!==o){D=J;break}}}if(r){y.validateAndMoveGripsToPx.call(j,D,y.getRightGripPositionPx.call(j))}else{y.validateAndMoveGripsToPx.call(j,y.getLeftGripPositionPx.call(j),D)}y.notify_mouse_up_implicit.call(j,r)}}p=undefined;x=undefined;o=undefined;w=undefined}});j.bind("keydown.nstSlider",function(B){if(j.data("enabled")){var A=function(C,D){var K=y.getLeftGripPositionPx.call(j),L=y.getRightGripPositionPx.call(j);if(typeof p==="undefined"){x=r?K:L;p=r?v.get_current_min_value.call(j):v.get_current_max_value.call(j)}switch(D.which){case 37:case 40:if(r){K--}else{L--}D.preventDefault();break;case 38:case 39:if(r){K++}else{L++}D.preventDefault();break}w=r?K:L;y.validateAndMoveGripsToPx.call(j,K,L);o=r?v.get_current_min_value.call(j):v.get_current_max_value.call(j)};if(f&&j.find(":focus").is(k)){r=false;A.call(j,k,B)}else{r=true;A.call(j,l,B)}}});var G=y.getLeftGripWidth.call(j),F=f?y.getRightGripWidth.call(j):G;j.data("left_grip_width",G);j.data("right_grip_width",F);j.data("value_bar_selector",b.value_bar_selector);if(!f){var h=g===E||g===e;y.setNakedBarDelta.call(j,h?"stickToSides":"middle",G)}if(e===E||m===g){v.set_range.call(j,e,E)}else{y.set_position_from_val.call(j,j.data("cur_min"),j.data("cur_max"))}y.notify_changed_implicit.call(j,"init");j.data("beforestart_min",v.get_current_min_value.call(j));j.data("beforestart_max",v.get_current_max_value.call(j));j.bind("mousedown.nstSlider",function(A){y.drag_start_func.call(j,A,b,l,k,false)});d.bind("touchstart.nstSlider",function(A){y.drag_start_func_touch.call(j,A,b,l,k,true)});d.bind("touchend.nstSlider",function(A){y.drag_end_func_touch.call(j,A)});d.bind("touchmove.nstSlider",function(A){y.drag_move_func_touch.call(j,A)});var H=j.data("histogram");if(typeof H!=="undefined"){v.set_step_histogram.call(j,H)}})},get_range_min:function(){var a=this;return a.data("range_min")},get_range_max:function(){var a=this;return a.data("range_max")},get_current_min_value:function(){var c=u(this);var a=v.get_range_min.call(c),d=v.get_range_max.call(c);var b=c.data("cur_min");var e;if(a>=b){e=a}else{e=v.round_value_according_to_rounding.call(c,b)}if(y.haveLimits.call(c)){if(e<=a){return c.data("lower-limit")}else{if(e>=d){return c.data("upper-limit")}}}else{if(e<=a){return a}else{if(e>=d){return d}}}return e},get_current_max_value:function(){var b=u(this);var a=v.get_range_min.call(b),c=v.get_range_max.call(b);var d=b.data("cur_max");var e;if(c<=d){e=c}else{e=v.round_value_according_to_rounding.call(b,d)}if(y.haveLimits.call(b)){if(e>=c){return b.data("upper-limit")}else{if(e<=a){return b.data("lower-limit")}}}else{if(e>=c){return c}else{if(e<=a){return a}}}return e},is_handle_to_left_extreme:function(){var a=this;if(y.haveLimits.call(a)){return a.data("lower-limit")===v.get_current_min_value.call(a)}else{return v.get_range_min.call(a)===v.get_current_min_value.call(a)}},is_handle_to_right_extreme:function(){var a=this;if(y.haveLimits.call(a)){return a.data("upper-limit")===v.get_current_max_value.call(a)}else{return v.get_range_max.call(a)===v.get_current_max_value.call(a)}},refresh:function(){var b=this;var c=b.data("last_step_histogram");if(typeof c!=="undefined"){v.set_step_histogram.call(b,c)}y.set_position_from_val.call(b,v.get_current_min_value.call(b),v.get_current_max_value.call(b));var d=b.data("highlightedRangeMin");if(typeof d==="number"){var a=b.data("highlightedRangeMax");v.highlight_range.call(b,d,a)}y.notify_changed_implicit.call(b,"refresh");return b},disable:function(){var a=this,b=a.data("settings");a.data("enabled",false).find(b.left_grip_selector).attr("aria-disabled","true").end().find(b.right_grip_selector).attr("aria-disabled","true");return a},enable:function(){var a=this,b=a.data("settings");a.data("enabled",true).find(b.left_grip_selector).attr("aria-disabled","false").end().find(b.right_grip_selector).attr("aria-disabled","false");return a},is_enabled:function(){var a=this;return a.data("enabled")},set_position:function(c,e){var b=this;var d=b.data("cur_min"),a=b.data("cur_max");if(c>e){y.set_position_from_val.call(b,e,c)}else{y.set_position_from_val.call(b,c,e)}y.refresh_grips_style.call(b);y.notify_changed_implicit.call(b,"set_position",d,a);b.data("beforestart_min",c);b.data("beforestart_max",e)},set_step_histogram:function(l){var J=this;J.data("last_step_histogram",l);if(typeof l==="undefined"){u.error("got an undefined histogram in set_step_histogram");y.unset_step_histogram.call(J)}var e=y.getSliderWidthPx.call(J)-J.data("left_grip_width"),i=l.length;if(e<=0){return}var b;var I=0;for(b=0;b<i;b++){I+=l[b]}if(I===0){v.unset_step_histogram.call(J);return J}var N=parseFloat(I)/e;for(b=0;b<i;b++){l[b]=l[b]/N}var f=[l[0]];for(b=1;b<i;b++){var M=f[b-1]+l[b];f.push(M)}f.push(e);var L=[J.data("range_min")];var m=0;var H=L[0];var c=0;while(m<=e){var a=parseInt(f.shift(),10);var h=y.inverse_rangemap_0_to_n.call(J,c+1,i+1);c++;var d=a-m;var j=h-H;for(b=m;b<a;b++){var g=H+(j*(b-m+1)/d);L.push(g);m++;H=g}if(m===e){break}}L[L.length-1]=J.data("range_max");var k=function(A){return L[parseInt(A,10)]};var K=function(A){var B=y.binarySearch.call(J,L,A,function(D,C){return D[C]},y.binarySearchValueToPxCompareFunc);if(L[B]===A){return B}if(Math.abs(L[B-1]-A)<Math.abs(L[B]-A)){return B-1}return B};J.data("pixel_to_value_mapping",k);J.data("value_to_pixel_mapping",K);return J},unset_step_histogram:function(){var a=this;a.removeData("pixel_to_value_mapping");a.removeData("value_to_pixel_mapping");a.removeData("last_step_histogram");return a},set_range:function(a,d){var b=this;var c=v.get_current_min_value.call(b),e=v.get_current_max_value.call(b);b.data("range_min",a);b.data("range_max",d);y.set_position_from_val.call(b,c,e);y.notify_changed_implicit.call(b,"set_range",c,e);return b},highlight_range:function(a,c){var b=this;var d=b.data("settings");if(typeof d.highlight==="undefined"){u.error('you cannot call highlight_range if you haven\' specified the "highlight" parameter in construction!')}if(!a){a=0}if(!c){c=0}var g=v.value_to_px.call(b,a),f=v.value_to_px.call(b,c),e=f-g+b.data("left_grip_width");var h=b.find(d.highlight.panel_selector);h.css("left",g+"px");h.css("width",e+"px");b.data("highlightedRangeMin",a);b.data("highlightedRangeMax",c);y.refresh_grips_style.call(b);return b},set_rounding:function(e){var b=this;if(typeof e==="string"&&e.indexOf("{")>-1){e=u.parseJSON(e)}b.data("rounding",e);var c=[];if(typeof e==="object"){var a;for(a in e){if(e.hasOwnProperty(a)){var d=e[a];c.push({range:d,value:a})}}c.sort(function(f,g){return f.range-g.range});b.data("rounding_ranges",c)}else{b.removeData("rounding_ranges")}return b},get_rounding:function(){var a=this;return a.data("rounding")},round_value_according_to_rounding:function(d){var b=this;var e=y.get_rounding_for_value.call(b,d);if(e>0){var f=d/e;var c=parseInt(f,10);var a=f-c;if(a>0.5){c++}var g=c*e;return g}else{u.error("rounding must be > 0, got "+e+" instead")}return d},value_to_px:function(b){var a=this,c=a.data("value_to_pixel_mapping");if(typeof c!=="undefined"){return c(b)}var d=y.getSliderWidthPx.call(a)-a.data("left_grip_width");return y.rangemap_0_to_n.call(a,b,d)}};var z="nstSlider";u.fn[z]=function(a){if(v[a]){if(this.data("initialized")===true){return v[a].apply(this,Array.prototype.slice.call(arguments,1))}else{throw new Error("method "+a+" called on an uninitialized instance of "+z)}}else{if(typeof a==="object"||!a){this.data("initialized",true);return v.init.apply(this,arguments)}else{u.error("Cannot call method "+a)}}}})(jQuery);